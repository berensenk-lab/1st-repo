name: Security Issue Auto-Reporter

on:
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  create-remediation-issues:
    runs-on: ubuntu-latest
    steps:
      - name: Create Critical CVE Issue for minikube
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '🚨 CRITICAL: 7 Critical CVEs in almosega/minikube:patched',
              body: `## Urgent Security Alert\n\n**Image:** almosega/minikube:patched\n**Critical CVEs:** 7\n**High CVEs:** 63\n**Medium CVEs:** 123\n\n### Top Vulnerable Packages\n- Go stdlib (1.19.8, 1.24.0+) - Multiple critical CVEs\n- golang.org/x/crypto - Cryptographic vulnerabilities\n- github.com/docker/docker 27.0.2 - Container runtime issues\n\n### Immediate Actions Required\n1. Update Go to 1.24.11 or later\n2. Update crypto libraries\n3. Update container dependencies\n4. Rebuild and rescan\n\n### Timeline\n- Target: Fix within 48 hours\n- Priority: Critical`,
              labels: ['security', 'critical', 'cve', 'minikube']
            });
      
      - name: Create Medium CVE Issue for open-webui
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '⚠️ Medium Priority: 5 Medium CVEs in almosega/open-webui:patched',
              body: `## Security Alert - Medium Priority\n\n**Image:** almosega/open-webui:patched\n**Medium CVEs:** 5\n**Low CVEs:** 86\n\n### Vulnerable Packages\n- python3.11 - 4 Medium CVEs\n- tar - 1 Medium CVE\n\n### Recommended Actions\n1. Update python3.11 to 3.11.12+\n2. Update tar package\n3. Consider upgrading to Python 3.12/3.13\n4. Rebuild and rescan\n\n### Timeline\n- Target: Fix within 1 week\n- Priority: Medium`,
              labels: ['security', 'medium', 'cve', 'open-webui']
            });
